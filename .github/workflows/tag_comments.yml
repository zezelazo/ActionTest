name: Tag comments 

# Define the event that triggers the workflow
on:
  workflow_dispatch:
    # Run the workflow every hour

 
env:
  # Set the value of the GH_TOKEN environment variable to the token associated with the GitHub App used to run the workflow
  GH_TOKEN: ${{ github.token }}

# Define the job that the workflow will run
jobs:
  tag-issues:
    runs-on: ubuntu-latest
    
    # Allow the workflow to modify issues in the repository
    permissions:
      issues: write 
      contents: read

    steps:
      # Checkout the code from the repository
      - name: Checkout repository
        uses: actions/checkout@v2

      # Tag issues based on their labels, assignees, and creation time
     
      - name: Tag issues
        shell: pwsh
        run: |
          $ignored_tag = 'type-repo_work'
          $area_unknown_tag = 'area-unknown'
          
          # Get the list of issues and filter to get only: "open issues" and  "without specific labels" and filter the issues with no "area-" label assign
          $issues = gh issue list --json number,labels,title --search "is:open -label:$ignored_tag" | ConvertFrom-Json | select number, labels, title | where-object { $_.labels.name -notlike "area-*" }
          foreach ($issue in $issues){
            Write-Host "$($issue.number) - $($issue.title)"
          }

          $discussions =  gh api --header 'Accept: application/vnd.github+json' --header 'X-GitHub-Api-Version:2022-11-28' --method GET  /repos/{owner}/{repo}/discussions
          foreach ($discussion in $discussions) { 
              Write-Host "Discussion: $($discussion.title)" 
          }